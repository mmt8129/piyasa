<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PRO DASHBOARD</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Orbitron:wght@500&display=swap" rel="stylesheet">
    <style>
        :root { --orange: #ff8c00; --shadow: 0 4px 15px rgba(0,0,0,0.15); }
        body { font-family: 'Inter', sans-serif; background: #f4f7f6; margin: 0; padding: 15px; color: #333; overflow-x: hidden; }
        
        /* √úST KARE KUTULAR */
        .top-row { display: flex; gap: 15px; margin-bottom: 15px; height: 130px; }
        .box { flex: 1; background: white; border: 1px solid var(--orange); border-radius: 15px; box-shadow: var(--shadow); padding: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; cursor: pointer; position: relative; overflow: hidden; }
        
        /* HAVA DURUMU */
        .weather-icon { font-size: 40px; margin-bottom: 5px; }
        .weather-temp { font-size: 22px; font-weight: bold; }
        .weather-desc { font-size: 11px; text-transform: uppercase; color: #777; }

        /* Pƒ∞YASA D√ñNG√úS√ú */
        .market-slider { width: 100%; height: 100%; position: relative; }
        .market-item { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; opacity: 0; }
        .market-item.active { opacity: 1; }
        .market-val { color: #2ecc71; font-weight: bold; font-size: 18px; margin-top: 5px; }

        /* NAMAZ Dƒ∞KD√ñRTGEN */
        .namaz-strip { background: white; border: 1px solid var(--orange); border-radius: 12px; box-shadow: var(--shadow); padding: 12px; display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px; cursor: pointer; }
        .namaz-label { font-size: 13px; font-weight: bold; color: #555; }
        .namaz-time { font-family: 'Orbitron', sans-serif; font-size: 22px; font-weight: bold; color: #222; }

        /* TURUNCU √áƒ∞ZGƒ∞ */
        .separator { height: 3px; background: linear-gradient(to right, transparent, var(--orange), transparent); margin-bottom: 20px; box-shadow: 0 2px 5px rgba(255,140,0,0.3); }

        /* HABERLER */
        .news-card { background: white; border: 1px solid var(--orange); border-radius: 12px; box-shadow: var(--shadow); display: flex; margin-bottom: 12px; overflow: hidden; height: 90px; cursor: pointer; }
        .news-img { width: 90px; height: 90px; object-fit: cover; background: #eee; }
        .news-content { flex: 1; padding: 10px; display: flex; flex-direction: column; justify-content: space-between; }
        .news-title { font-size: 13px; font-weight: bold; line-height: 1.3; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .news-source { font-size: 10px; color: var(--orange); font-weight: bold; }

        /* PENCERELER (MODAL) */
        .modal { display: none; position: fixed; bottom: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: flex-end; }
        .modal-content { background: white; width: 90%; max-height: 70%; border-radius: 20px 20px 0 0; border: 1px solid var(--orange); padding: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.2); animation: slideUp 0.3s ease-out; overflow-y: auto; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .close-btn { background: var(--orange); color: white; border: none; width: 100%; padding: 12px; border-radius: 10px; font-weight: bold; margin-top: 15px; }
        .modal-list-item { padding: 12px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; font-size: 14px; }

        /* HABER DETAY */
        .news-detail-img { width: 100%; border-radius: 10px; margin-bottom: 10px; }
        .news-detail-text { font-size: 14px; line-height: 1.5; color: #444; }
        .go-site { background: #2a5298; color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; text-decoration: none; display: block; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="top-row">
        <div class="box" onclick="openModal('modal-weather')">
            <div id="w-icon" class="weather-icon">‚òÄÔ∏è</div>
            <div id="w-temp" class="weather-temp">--¬∞C</div>
            <div id="w-desc" class="weather-desc">Y√ºkleniyor</div>
        </div>
        <div class="box" onclick="openModal('modal-market')">
            <div class="market-slider" id="market-slider">
                <div class="market-item active"><span>USD/TRY</span><span class="market-val" id="slide-usd">--</span></div>
                <div class="market-item"><span>EUR/TRY</span><span class="market-val" id="slide-eur">--</span></div>
                <div class="market-item"><span>GRAM ALTIN</span><span class="market-val" id="slide-ga">--</span></div>
            </div>
        </div>
    </div>

    <div class="namaz-strip" onclick="openModal('modal-namaz')">
        <span id="n-next-name" class="namaz-label">SIRADAKƒ∞: --</span>
        <span id="n-next-time" class="namaz-time">--:--</span>
    </div>

    <div class="separator"></div>

    <div id="news-list"></div>

    <div id="modal-weather" class="modal"><div class="modal-content"><h3>5 G√úNL√úK HAVA</h3><div id="list-weather"></div><button class="close-btn" onclick="closeModal()">TAMAM</button></div></div>
    <div id="modal-market" class="modal"><div class="modal-content"><h3>T√úM Pƒ∞YASALAR</h3><div id="list-market"></div><button class="close-btn" onclick="closeModal()">TAMAM</button></div></div>
    <div id="modal-namaz" class="modal"><div class="modal-content"><h3>VAKƒ∞TLER</h3><div id="list-namaz"></div><button class="close-btn" onclick="closeModal()">TAMAM</button></div></div>
    <div id="modal-news" class="modal"><div class="modal-content" id="news-detail-content"></div></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAwQfifK4eaSrSjKpA776hD0RAlx_6a2_w",
            databaseURL: "https://piyasa-9049c-default-rtdb.firebaseio.com",
            projectId: "piyasa-9049c"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. HAVA DURUMU Sƒ∞STEMƒ∞
        db.ref("hava").on("value", s => {
            const d = s.val();
            if(!d) return;
            const cur = d.current_condition[0];
            document.getElementById('w-temp').innerText = cur.temp_C + "¬∞C";
            document.getElementById('w-desc').innerText = cur.lang_tr[0].value;
            document.getElementById('w-icon').innerText = getWeatherEmoji(cur.weatherCode);

            let listHtml = '';
            d.weather.slice(0, 5).forEach(day => {
                listHtml += `<div class="modal-list-item"><span>${day.date}</span><span>${getWeatherEmoji(day.hourly[4].weatherCode)} ${day.maxtempC}¬∞ / ${day.mintempC}¬∞</span></div>`;
            });
            document.getElementById('list-weather').innerHTML = listHtml;
        });

        // 2. Pƒ∞YASA D√ñNG√úS√ú (3 Saniye)
        let slideIdx = 0;
        setInterval(() => {
            const items = document.querySelectorAll('.market-item');
            items[slideIdx].classList.remove('active');
            slideIdx = (slideIdx + 1) % items.length;
            items[slideIdx].classList.add('active');
        }, 3000);

        db.ref("piyasa").on("value", s => {
            const data = s.val();
            if(!data) return;
            document.getElementById('slide-usd').innerText = data.currency.find(x=>x.Kod=="USD").Satis;
            document.getElementById('slide-eur').innerText = data.currency.find(x=>x.Kod=="EUR").Satis;
            document.getElementById('slide-ga').innerText = data.gold.find(x=>x.Kod=="GA").Satis;

            let listHtml = '';
            data.gold.concat(data.currency).forEach(i => {
                listHtml += `<div class="modal-list-item"><span>${i.Aciklama}</span><span style="color:green;font-weight:bold">${i.Satis}</span></div>`;
            });
            document.getElementById('list-market').innerHTML = listHtml;
        });

        // 3. NAMAZ VAKTƒ∞
        db.ref("namaz/items/0").on("value", s => {
            const n = s.val();
            if(!n) return;
            const vakitler = { "ƒ∞MSAK": n.fajr, "√ñƒûLE": n.dhuhr, "ƒ∞Kƒ∞NDƒ∞": n.asr, "AK≈ûAM": n.maghrib, "YATSI": n.isha };
            
            // Sƒ±radaki vakti bul (Basit mantƒ±k)
            let now = new Date().getHours() + ":" + new Date().getMinutes();
            let next = "ƒ∞MSAK", time = n.fajr;
            for(let v in vakitler) { if(vakitler[v] > now) { next = v; time = vakitler[v]; break; } }
            
            document.getElementById('n-next-name').innerText = "SIRADAKƒ∞: " + next;
            document.getElementById('n-next-time').innerText = time;

            let listHtml = '';
            for(let v in vakitler) { listHtml += `<div class="modal-list-item"><span>${v}</span><span class="namaz-time" style="font-size:16px">${vakitler[v]}</span></div>`; }
            document.getElementById('list-namaz').innerHTML = listHtml;
        });

        // 4. HABERLER (KARI≈ûIK)
        const sources = { 'haber_trt': 'TRT HABER', 'haber_cnn': 'CNN T√úRK', 'haber_ntv': 'NTV' };
        let allNews = [];
        Object.keys(sources).forEach(k => {
            db.ref(k + "/items").on("value", s => {
                if(s.val()) {
                    const newsWithSrc = s.val().slice(0,4).map(i => ({...i, src: sources[k]}));
                    allNews = allNews.filter(x => x.src !== sources[k]).concat(newsWithSrc);
                    renderNews();
                }
            });
        });

        function renderNews() {
            const container = document.getElementById('news-list');
            container.innerHTML = '';
            allNews.forEach((n, index) => {
                const img = n.enclosure ? n.enclosure.link : (n.thumbnail || 'https://via.placeholder.com/90?text='+n.src);
                container.innerHTML += `
                    <div class="news-card" onclick="showNewsDetail(${index})">
                        <img src="${img}" class="news-img">
                        <div class="news-content">
                            <div class="news-title">${n.title}</div>
                            <div class="news-source">${n.src}</div>
                        </div>
                    </div>`;
            });
        }

        function showNewsDetail(idx) {
            const n = allNews[idx];
            const img = n.enclosure ? n.enclosure.link : (n.thumbnail || '');
            document.getElementById('news-detail-content').innerHTML = `
                <h3>${n.title}</h3>
                ${img ? `<img src="${img}" class="news-detail-img">` : ''}
                <div class="news-detail-text">${n.description || 'Haber i√ßeriƒüi y√ºklenemedi.'}</div>
                <a href="${n.link}" target="_blank" class="go-site">Sƒ∞TEYE Gƒ∞T</a>
                <button class="close-btn" onclick="closeModal()">TAMAM</button>`;
            openModal('modal-news');
        }

        // YARDIMCI FONKSƒ∞YONLAR
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
        function getWeatherEmoji(code) {
            const map = {"113":"‚òÄÔ∏è","116":"‚õÖ","119":"‚òÅÔ∏è","122":"‚òÅÔ∏è","263":"üå¶Ô∏è","266":"üå¶Ô∏è","302":"üåßÔ∏è","308":"üåßÔ∏è","338":"‚ùÑÔ∏è"};
            return map[code] || "‚òÄÔ∏è";
        }
    </script>
</body>
</html>
